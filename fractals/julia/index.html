<!DOCTYPE html>
<html>
  <head>
    <link rel="stylesheet" type="text/css" href="../../css/main.css" />
    <script src="../../math-library/math-complexnumbers.js"></script>
    <script src="../../math-library/graphicfunctions.js"></script>
    <script src="../fractals-data/juliaset.data.js"></script>
    <script src="../fractals-library/controls.js"></script>
    <script src="../fractals-library/library.js"></script>
    <script src="../../navigation/menu.js"></script>
  </head>
  <body onload="init();">
    <table border="0">
      <tr>
        <td>
          <canvas
            id="myCanvas"
            width="1000"
            height="700"
            style="border: 1px solid;"
          ></canvas>
        </td>
        <td valign="top">
          <div id="dropdowns"></div>
          <div id="dynamicSliders"></div>
          <div id="menu"></div>
        </td>
      </tr>
    </table>
    <script>

 "use strict";
 //--------------------------------------------
 function init() {
        genNavigation("julia");
        generateControls(); //sliders
        document.getElementById("dropdowns").innerHTML = generateDropdown("dd1");
        fileToParameters(); //initiate event listener for file uploader
        go();
        reMap.drawAxis();
      }
 //--------------------------------------------      //--- global PARAMETERS ------------------------------------------------------------------
      const myCanvas = document.getElementById("myCanvas");
      const ctx = myCanvas.getContext("2d");

      const cW = 1000; //ctx.clientWidth;
      const cH = 700; //ctx.clientHeight;a

      //--- parameters the user can change (WIP)
      // -- global variables
      var x0 = params.x0.val;
      var x1 = params.x1.val;
      var y0 = params.y0.val;
      var y1 = params.y1.val;
      var grid = params.grid.val; //resolution
      var maxItr = params.iterations.val;
      var uBound = params.upperbound.val;

      const fixedOrigin=false;

      var reMap=new ReMap(cW,cH,x0,x1,y0,y1,fixedOrigin); //functions to map real value to canvas coordinates
          reMap.objCanvas=ctx;
      

      //--- calculated params
      var dx = reMap.dx();
      var dy = reMap.dy();

      //----------------------------------------------------------
      function julia(z,k,strF) {
        var z0 = z;
        var z0x = z.x; //need extra variable to calculate in 2 steps
        if (strF==null){strID="z2c"}
        
        if (strF=="z2c"){
          //-- classic Zn+1=(Zn)^2+k
          for (let i = 0; i < maxItr + 1; i++) {
            z0 = s(p(z0,z0),k);
            if (z0.x * z0.x + z0.y * z0.y > uBound) {
              return i;
            }
          }
        }

        if (strF=="hyp"){
          //-- hyperbolic Zn+1=k*Sin(Zn)
          for (let i = 0; i < maxItr + 1; i++) {
            z0.x = Math.sin(z0.x) * Math.cosh(z0.y);
            z0.y = Math.cos(z0x) * Math.sinh(z0.y);
            z0=p(k,z0);
            z0x=z0.x; //updates temporary  var z0x
            
            if (z0.x * z0.x + z0.y * z0.y > uBound) {
              return i;
            }
          }
        }
        


        return maxItr;
      }

      //_________________________________________________________________
      function loadvaluesandgo() {
        //go! button

        x0 = params.x0.val;
        x1 = params.x1.val;
        y0 = params.y0.val;
        y1 = params.y1.val;
        maxItr = params.iterations.val;
        uBound = params.upperbound.val;
      
        reMap.x0=x0;
        reMap.x1=x1;
        reMap.y0=y0;
        reMap.y1=y1;

        

      //--- calculated params
      dx = reMap.dx();
      dy = reMap.dy();

        go();
        reMap.drawAxis();
        reMap.drawUnitCircle();
      }

      //__________________________________________________________________
      function go() {


        //selected function
        var strF=getDropDownSelectedValue("dd1");
        console.log("selected function is: " + strF);

        //---clear canvas
        ctx.clearRect(0, 0, cW, cH);

        var x = x0;
        var y = y0;
        var itr = 0;
        var clr = 0;

        //var k=new c(-0.54,0.54); // ***** WIP *************
        //var k=new c(0.355,0.355); // ***** WIP *************
        //var k=new c(0.355,0.355); // ***** WIP *************
        //c = 0.355534 - 0.337292i
        //var k=new c(0.3555534,0.337292);
        var k=new c(params.cx.val,params.cy.val);

        for (let i = 0; i < grid; i++) {
          x = x + dx;
          y = y0;

          for (let j = 0; j < grid; j++) {
            y = y + dy;
            var tz = new c(x, y);
            
            itr = julia(tz,k,strF);
            if (itr < maxItr) {
              clr = 255 - 4 * Math.round((itr * 255) / maxItr);
              plot(reMap.x(x), reMap.y(y), getColor(itr));
            }
          }
        }
      }

      //__________________________________________________________________
      //__________________________________________________________________

     


      //init();
    </script>
  </body>
</html>
