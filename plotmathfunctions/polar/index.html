<!DOCTYPE html>
<html>
  <head>
    <script src="../../navigation/menu.js"></script>
    <link rel="stylesheet" type="text/css" href="../../css/main.css" />
    <script src="../../math-library/math-complexnumbers.js"></script>
    <script src="../../math-library/graphicfunctions.js"></script>
    <script src="../../fractals/fractals-library/controls.js"></script>
    <script src="../../fractals/fractals-library/library.js"></script>

    <script src="polar-library.js"></script>
    <script src="../../fractals/fractals-data/polar.data.js"></script>
  </head>
  <body onload="init();">
    <table border="0">
      <tr>
        <td valign="top">
              <div id="menu"></div>
              <hr>
              <div id="content"></div>
        </td>
        <td valign="top">
          <div id="canvasesdiv" style="position:relative; width:700px; height:700px"> 
            <canvas
              id="myCanvas"
              width="700"
              height="700"
              style="z-index: 1;
                      position:absolute;
                      left:0px;
                      top:0px;"
  
            ></canvas>
            <canvas id="transparentLayer"
            style="z-index: 2;
            position:absolute;
            left:0px;
            top:0px;
            border:1px solid;"
            height="700" width="700">          </div>
          </td>
          <td valign=top>
            <div id="dynamicSliders">placeholder</div>
            <hr>
            <div id="listFunctions">placeholder</div>
            <hr>
            <b>Coordinates</b><div id="mousecoordinates"></div>
        </td>
      </tr>
    </table>

<script>
"use strict";

//global variables here
      //--- global PARAMETERS ------------------------------------------------------------------
      const myCanvas = document.getElementById("myCanvas");
      const ctx = myCanvas.getContext("2d");
      var   cW = myCanvas.clientWidth;
      var   cH = myCanvas.clientHeight


      //--- parameters the user can change via sliders if made visible
      // -- global variables
        var t0 = params.t0.val;
        var t1 = params.t1.val;
        var dt = params.dt.val;
        var x0 = params.x0.val;
        var x1 = params.x1.val;
        
      
      const fixedOrigin = false;
      var lockRatio=true;
      var zoomIn=params.zoomIn.val;      

      const xIntervals=250;

      //wip
      const iGrid=20;
      const drawGrid=true;

      var reMap = new ReMap(cW, cH, x0, x1, x0, x1, fixedOrigin); //functions to map real value to canvas coordinates
      reMap.objCanvas = ctx;

        reMap.x0 = x0;
        reMap.x1 = x1;
        reMap.y0 = x0;
        reMap.y1 = x1;

     



//---------------------------------------
function init(){

        //--- mouse coordinates event listener --------------------------
        transparentLayer.addEventListener(
          "mousemove",
          function (evt) {
            var mousePos = getMousePos(evt);
            var tempC=new c(reMap.m2x(mousePos.x),reMap.m2y(mousePos.y));
            var message = `x=${tempC.x}<br>y=${tempC.y}`;
            writeMessage(message);
          },
          false
        );

        //--- mouse click event listener -------------------------------
        transparentLayer.addEventListener(
          "click",
          function (evt) {
            var mousePos = getMousePos(evt);

            zoomIn=params.zoomIn.val;
           

            //zoom in
            if (zoomIn==1){
            params.x0.val=reMap.m2x(mousePos.x)-(x1-x0)/4; 
            params.x1.val=reMap.m2x(mousePos.x)+(x1-x0)/4;
            }
            else {
            params.x0.val=reMap.m2x(mousePos.x)-(x1-x0); 
            params.x1.val=reMap.m2x(mousePos.x)+(x1-x0);
            }

            loadvaluesandgo();
            
          },
          false
        );

  

  genNavigation("polar",false);
  generateControls();
  displayFunctions();
  fileToParameters(); //initiate event listener for file uploader
  reMap.drawAxis();
  //if (params.grid.val==true){ reMap.drawGrid()};
  plotAll();

}
//---------------------------------------
function loadvaluesandgo() {

        t0 = params.t0.val;
        t1 = params.t1.val;
        dt = params.dt.val;
        x0 = params.x0.val;
        x1 = params.x1.val;
        
        reMap.x0 = x0;
        reMap.x1 = x1;
        reMap.y0 = x0;
        reMap.y1 = x1;


        reMap.clearcanvas();
        plotAll();
        reMap.drawAxis();
        //if (params.grid.val==true){ reMap.drawGrid()};

      }
//---------------------------------------



function plotAll(){

  for (const key in params.functions) {
      const element = params.functions[key];
      
      if (element != false){
      function f(t) {  
         return eval(element);  
      };  
      plotFunction(f,"#121212");
    }
  }


}

//________________________________________________________
/*
function f(exp) {  
  return eval(exp);  
};
*/
//_______________________________________________________


//-------------------------------------------
function plotFunction(objF,strColor) {

  ctx.beginPath();
  ctx.strokeStyle = strColor; //"#FF0000";
  ctx.lineWidth=0.5;
//  ctx.strokeStyle = "#0000D3";

  var ri=objF(t0);
  var rii=0;
  var xc,yc;
  
  ctx.moveTo(reMap.x(p2c(ri,t0).x),reMap.y(p2c(ri,t0).y)); //first point on the map

  for (let ti = t0+dt; ti < t1; ti=ti+dt) {
    console.log(ti);
    rii=objF(ti);
    xc=reMap.x(p2c(rii,ti).x);
    yc=reMap.y(p2c(rii,ti).y);
    ctx.lineTo(xc,yc);
    ctx.moveTo(xc,yc); //move to next point  
  }
    ctx.stroke();
 
}
//-------------------------------------------
// polar to cartesian
function p2c(r,t){
  return {
         x: r * Math.cos(t),
         y: r * Math.sin(t)
         }
}
//-------------------------------------------


function displayFunctions(){

 document.getElementById("listFunctions").innerHTML=listFunctions();

}



</script> 

</body>
</html>
