<!DOCTYPE html>
<html>

<body>
<table border="1">
  <tr>
    <td><canvas id="myCanvas" width="1000" height="700" style="border:1px solid">
      Your browser does not support the HTML5 canvas tag.</canvas></td>
    <td>controls will be here</td>
  </tr>
</table>


<script>
//--- PARAMETERS ---  
const c = document.getElementById("myCanvas");
const ctx = c.getContext("2d"); 
const cW=c.clientWidth;
const cH=c.clientHeight;
const pi=Math.PI;
const initAngle=pi/2;      //trunk angle
const dAngle=pi/8;         //half of bifurcation angle, pi/8 nice
const initLen=150;         //max 150
const minLen=30;           //20, 25 nice
const reduction=0.8;       //0.8 nice
const initTrunk=20;        //trunk initial thickness
const trunkReduction=0.5;  //trunk => tree reduction factor 
const minBranch=0.1;       // branches min thickness

//-------------------- INIT---------------------------
function init(){
    //ctx.beginPath();     
    draw(0,0,initAngle,initLen,initTrunk);
    draw(-200,0,initAngle,70,10);
    draw(200,0,initAngle,80,10);
  }  
//----------------------------------------------------
//--- this functions remap the canvas. The origin is the middle point of the rect base. 
function px(x){
  return cW/2+x;
}
function py(y){
  return cH-y;
}
function plot(x,y) {
  //for debugging only
  ctx.beginPath();
  ctx.fillStyle = "#FF0000";
  ctx.fillRect(x,y,3,3);
}
//---------- DRAW --------------------------------------------
function draw(x,y,angle,len,trunk){
  
    var newx=x+len*Math.cos(angle);
    var newy=y+len*Math.sin(angle);
    
    ctx.lineWidth = minBranch+trunk;
    ctx.strokeStyle = "brown";   
    ctx.beginPath();
    //ctx.save(); // check later to better understand

    ctx.moveTo(px(x),py(y));
    ctx.lineTo(px(newx),py(newy));
    ctx.stroke();
    if (len >= minLen) {      

      draw(newx,newy,angle+pi/2*Math.random()*dAngle,len*reduction,trunk*trunkReduction);
      draw(newx,newy,angle-pi/2*Math.random()*dAngle,len*reduction,trunk*trunkReduction);
      draw(newx,newy,angle,len*reduction,trunk*trunkReduction);

    } else {
      leaf(newx,newy,.5*len,angle,2*pi/3);
    }
     
  }   
//------------ LEAF ----------------------------------------
function leaf(x,y,l,alpha,beta){
  /*
  x,y coordinate beginning leaf
  l: length of leaf
  alpha: angle of the leaf simmetry line
  b: angle of the arc describing the leaf 
  */

  var r=l/(2*Math.sin(beta/2));
  var gamma=pi/2-beta/2-alpha;
  var xc=0;
  var yc=0;


 // leaf first half ----------------------------
    
  //calc center
  xc=x+r*Math.cos(gamma);
  yc=y-r*Math.sin(gamma);
  
  //leaf'simmetry line
  ctx.beginPath();
  ctx.strokeStyle = "darkgreen";
  ctx.moveTo(px(x),py(y));
  ctx.lineTo(px(x+l*Math.cos(alpha)),py(y+l*Math.sin(alpha)));
  ctx.stroke(); 
  
  ctx.arc(px(xc),py(yc), r, 2*pi-(pi-gamma-beta),2*pi-(pi-gamma),true);
  ctx.fillStyle = "yellow";
  ctx.fill();
  ctx.stroke();
  
  // leaf second  half ----------------------------
  
  //calc center
  var diagonal=Math.sqrt(r*r-l*l/4)
  xc=xc-2*diagonal*Math.cos(gamma+beta/2);
  yc=2*diagonal*Math.sin(gamma+beta/2)+yc;

  ctx.beginPath();
  ctx.arc(px(xc),py(yc), r, -1*(alpha+beta/2)+pi/2,-1*(alpha-beta/2)+pi/2,false);
  ctx.fillStyle = "lightgreen";
  ctx.fill();
  ctx.stroke();  
}
//-----------------------------------------------------------------------

init();

</script> 
</body>
</html>
