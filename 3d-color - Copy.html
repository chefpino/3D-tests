<!DOCTYPE html>
<html>

<body>
<table border="1">
  <tr>
    <td><canvas id="myCanvas" width="100" height="100" style="border:1px solid"></canvas></td>
    <td valign="top">
      Resolution <input type="range" min="2" max="100" id="resolution" onchange="reDraw(this);"><br>
      tbd  <br>
      tbd  <br>
    </td>
</tr>
</table>
<script>

//-----------------------------
const canvas = document.getElementById("myCanvas");
const cW=900; //canvas.clientWidth;
const cH=600; //canvas.clientHeight;
const ctx = canvas.getContext("2d"); 
canvas.width=cW;
canvas.height=cH;
//ctx.scale(1,1);

const x0=-2;
const x1=2;
const y0=-2;
const y1=2;
const z0=-2;
const z1=2;

function g(x,y) {
  //return 2-2*Math.sin(.02*(x*x+y*y)); //--sgabello
  //return Math.sqrt(x*x+y*y);         //--cono
  //return 5-Math.abs(x+y)-Math.abs(x-y); 
  //return Math.sin(.5*x+y)*Math.cos(.5*y-x); //bello,0,10,0,10,-12,12
   // return x*(.5*x-2*y);
  //return 50/(x*x+y*y);
  return x*x-.3*y*y;
  return 0;
}

//--------------
//graphic mapping paramenters (linear transformation of the given intervals to the canvas rect)
const a=-1*(1/4)*cW/(x1-x0);
const b=(1/4)*cW/(y1-y0);
const c=-1*(1/4)*cH/(x1-x0);
const d=-1*(1/4)*cH/(y1-y0);
const f=cH/(z1-z0); //factor for scaling z values

//====================================================
function mapToCanvas(x,y,z){
  //this maps the origin into the middle of the canvas, also flips vertically
  //mx,my maps the original domain to the floor of the function
  //mz, projects the results in 3d
  return {mx: a*(x-x0)+b*(y-y0)+cW/2,
          my: cH/2-(c*(x-x0)+d*(y-y0)),
          mz: cH/2-(c*(x-x0)+d*(y-y0))-((z)*f)
        }  
}
//====================================================

function reDraw(tObj) {
  var i=1*tObj.value;
  ctx.clearRect(0, 0, cW, cH);
  drawPavement(10);
  plotColoredFunction(i);
}

//-------------------------------------------
function plot(x,y) {
  ctx.beginPath();
  //ctx.fillStyle = "#FF0000";
  ctx.fillRect(x,y,2,2);
}
//-------------------------------------------
function drawXYZAxis() {  
  ctx.strokeStyle = "#D3D3D3"; 
  //Z axis
  ctx.moveTo(cW/2,cH/2);
  ctx.lineTo(cW/2,0);
  ctx.stroke();
  //X axis
  ctx.moveTo(cW/2,cH/2);
  ctx.lineTo(0,cH);
  ctx.stroke();
  //Y axis
  ctx.moveTo(cW/2,cH/2);
  ctx.lineTo(cW,cH);
  ctx.stroke(); 
 
};

function mapLine(xo,yo,xe,ye) {
  
  ctx.beginPath();
  ctx.moveTo(mapToCanvas(xo,yo).mx,mapToCanvas(xo,yo).my);
  ctx.lineTo(mapToCanvas(xe,ye).mx,mapToCanvas(xe,ye).my);
  ctx.strokeStyle = "#D3D3D3";
  ctx.stroke();  
}
//-------------------------------------------------  
function drawPavement(n) {
  
  const dx=(x1-x0)/n;
  const dy=(y1-y0)/n;

  for (let index = 0; index < n+1; index++) {
    
    mapLine(x0+index*dx,y0,x0+index*dx,y1);
    mapLine(x0,y0+index*dy,x1,y0+index*dy);
    
  }
}
//-----------------------------------------------


function drawColumns(n) {
  
  const dx=(x1-x0)/n;
  const dy=(y1-y0)/n;
  var ix=x0;
  var iy=y0;
  var i=0;
  var j=0;
  var strColor="#0000"

  for   (i = 0; i < n+1; i++) {
    for (j = 0; j < n+1; j++) {
      
      ix=x0+i*dx;
      iy=y0+j*dy;
      
      ctx.beginPath();
      //plot(mapToCanvas(ix,iy,0).mx,mapToCanvas(ix,iy,0).my);
      ctx.moveTo(mapToCanvas(ix,iy,0).mx,mapToCanvas(ix,iy,0).my);
      ctx.lineTo(mapToCanvas(ix,iy,g(ix,iy)).mx,mapToCanvas(ix,iy,g(ix,iy)).mz);
      ctx.strokeStyle = strColor+i+j;
      ctx.stroke();
      plot(mapToCanvas(ix,iy,0).mx,mapToCanvas(ix,iy,g(ix,iy)).mz);
      
      
    }
  }
}
//-------------------------------



function plotColoredFunction(n) {

const dx=(x1-x0)/n;
const dy=(y1-y0)/n;
var ix=x0;
var iy=y0;
var i=0;
var j=0;



ctx.strokeStyle = "#0000D3";
//ctx.fillStyle = "#FF0000";

var iTemp=0;



for   (i = 0; i < n; i++) {    
  ix=x0+i*dx;
  for (j = 0; j < n; j++) {      
    iy=y0+j*dy;  
    ctx.beginPath();    
    ctx.moveTo(mapToCanvas(ix,iy,g(ix,iy)).mx,mapToCanvas(ix,iy,g(ix,iy)).mz);
    ctx.lineTo(mapToCanvas(ix+dx,iy,g(ix+dx,iy)).mx,mapToCanvas(ix+dx,iy,g(ix+dx,iy)).mz);
    ctx.lineTo(mapToCanvas(ix+dx,iy+dy,g(ix+dx,iy+dy)).mx,mapToCanvas(ix+dx,iy+dy,g(ix+dx,iy+dy)).mz);
    ctx.lineTo(mapToCanvas(ix,iy+dy,g(ix,iy+dy)).mx,mapToCanvas(ix,iy+dy,g(ix,iy+dy)).mz);
    ctx.closePath();
    iTemp=3*Math.round(256*g(ix,iy)/(z1-z0));
    ctx.stroke();
    ctx.fillStyle = "rgb(200, "+iTemp+", 100)";
    //console.log("rgb(0, "+iTemp+", 255)");
    ctx.fill();
    
    
  }
}

}



//---------------------------------------------
//drawXYZAxis();
drawPavement(10);
//plot(mapToCanvas(0,0,0).mx,mapToCanvas(0,0,0).my);

//drawColumns(50);
plotColoredFunction(30);
//plot(mapToCanvas(0,0,1).mx,mapToCanvas(0,0,1).my);

</script>
</body>
</html>