<!DOCTYPE html>
<html>
  <head>
    <link rel="stylesheet" type="text/css" href="../../css/main.css" />
    <script src="../../navigation/menu.js"></script>
    <script "../../navigation/controls.js"></script>
    <script src="../data/3d-color.data.js"></script>
  </head>

  <body onload="init();">
    <table border="0">
      <tr>
        <td valign="top">
          <div id="menu"></div>
          <hr />
          <div id="content"></div>
          <hr />
          <div id="dynamicSliders"></div>
        </td>
        <td>
          <canvas
            id="myCanvas"
            width="900"
            height="600"
            style="border: 1px solid;"
          ></canvas>
        </td>
      </tr>
    </table>
    <script>
          "use strict";



      //-----------------------------
      const canvas = document.getElementById("myCanvas");
      const cW = 900; //canvas.clientWidth;
      const cH = 600; //canvas.clientHeight;
      const ctx = canvas.getContext("2d");
      //canvas.width = cW;
      //canvas.height = cH;
      //ctx.scale(1,1);

      //--- declare global variables
      var x0 = -10;
      var x1 = 10;
      var y0 = -10;
      var y1 = 10;
      var resolution = 30;

      var alpha = Math.PI / 6;; //Math.PI/6;
      var beta = 0; //-Math.PI / 4;

      
      //---point in 3d space  
      function p3(x, y, z) {
        return {
          x: x,
          y: y,
          z: z
        };
      }
      //---point on canvas
      function pc(x,y) {
        return {
          x: x,
          y: y
        }
} 



      //------------------------------------------------------------------
      function init() {
        genNavigation("threeD",false);
        generateControls();
        fileToParameters(); //initiate event listener for file uploader
        var tempPt1,tempPt2;

        //tests go here ============================
        //console.log(r2c(0,0,0).x);
        //plot(r2c(0,0,0).x,r2c(0,0,0).y);
        //plot(0,0);
        //drawPavement(50);
         

        console.log(proj(x0,y0,0)); //ok
        console.log(proj(x1,y0,0)); //ok

        console.log(proj(x0,y1,0)); //ok
        console.log(proj(x1,y1,0)); //ok

        tempPt1=r2c(x0, y0,0); 
        tempPt2=r2c(x0, y1,0); 

        console.log(tempPt1.x + " : " +tempPt1.y)
        console.log(tempPt2.x + " : " +tempPt2.y)

          drawLine(tempPt1.x, tempPt1.y, tempPt2.x, tempPt2.y);



        //==========================================
      }
      //-----------------------------------------------------------------------
      function loadvaluesandgo() {
        //go! button

        // -- load parameters from params object
        x0 = params.x0.val;
        x1 = params.x1.val;
        y0 = params.y0.val;
        y1 = params.y1.val;
        z0 = params.z0.val;
        z1 = params.z1.val;
        resolution = params.resolution.val;

        //--- calculated params, if any

        //---clear canvas
        ctx.clearRect(0, 0, cW, cH);

        //--- draw base domain
        //drawPavement(50);

        //---plot function
        // wip plotColoredFunction(resolution);
      }
      //---------------------------------------------------------------
      function g(x, y) {
        //return 2-2*Math.sin(.02*(x*x+y*y)); //--sgabello
        //return Math.sqrt(x*x+y*y);         //--cono
        //return 5-Math.abs(x+y)-Math.abs(x-y);
        //return Math.sin(0.5 * x + y) * Math.cos(0.5 * y - x); //bello,0,10,0,10,-12,12
        // return x*(.5*x-2*y);
        //return 50/(x*x+y*y);
        //return x*x-.3*y*y;
        return 0;
      }
      //------------------------------------------------------------------------
      function proj(x, y, z) {
        //1 to 1 projected points onto a screen

        var xp = x * Math.cos(alpha) - y * Math.sin(alpha);

        //distance from screen
        var p = Math.sqrt(x * x + y * y - xp * xp);

        var yp = p * Math.sin(beta) + z * Math.cos(beta);

        var pt=new pc(xp,yp); //canvas 1 to 1 coordinates

        return pt;
        
      }
      //------------------------------------------------------------------------

      //====================================================
      function ptoC(xp,yp) {

        //maps the projected point to fit the size of the canvas
        //function 2d => 2d 

        //middle of actual range
        var xm = (x1 + x0) / 2;
        var ym = (y1 + y0) / 2;

        var pmc=proj(xm,ym,0); //middle point of range projected on canvas

        var K=10; //scale
        
        return {
          x: cW/2 + (xp - pmc.x) * K,
          y: cH/2 - ((yp - pmc.y)) * K
        };
      }
      //====================================================
       
     //--- real point R3 to canvas

      function r2c(x,y,z){

         var pt=proj(x,y,z);
         return ptoC(pt.x,pt.y); //returns ptoC.x, ptoC.y

      }
       
      function drawPavement(n){
        
        //tiling pavement, then mapping it to canvas
        const dx = (x1 - x0) / n;
        const dy = (y1 - y0) / n;
        var tempPt1;
        var tempPt2;

        for (let index = 0; index < n + 1; index++) {
          
          tempPt1=r2c(x0 + index * dx, y0,0); 
          tempPt2=r2c(x0 + index * dx, y1,0); 

          drawLine(tempPt1.x, tempPt1.y, tempPt2.x, tempPt2.y);

          tempPt1=r2c(x0, y0 + index * dy,0); 
          tempPt2=r2c(x1, y0 + index * dy,0); 

          drawLine(tempPt1.x, tempPt1.y, tempPt2.x, tempPt2.y);
        }

      }

      function drawLine(xo, yo, xe, ye) {
        ctx.beginPath();
        ctx.moveTo(xo, yo);
        ctx.lineTo(xe, ye);
        ctx.strokeStyle = "#D3D3D3";
        ctx.stroke();
      }



      //-------------------------------------------
      function plot(x, y) {
        ctx.beginPath();
        //ctx.fillStyle = "#FF0000";
        ctx.fillRect(x, y, 2, 2);
      }
      //-------------------------------------------

      
    </script>
  </body>
</html>
