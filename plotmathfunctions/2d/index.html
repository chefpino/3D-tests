<!DOCTYPE html>
<html>
  <head>
    <script src="../../navigation/menu.js"></script>
    <link rel="stylesheet" type="text/css" href="../../css/main.css" />
    <script src="../../math-library/math-complexnumbers.js"></script>
    <script src="../../math-library/graphicfunctions.js"></script>
    <script src="../../fractals/fractals-library/controls.js"></script>
    <script src="../../fractals/fractals-data/twod.data.js"></script>
  </head>
  <body onload="init();">
    <table border="0">
      <tr>
        <td valign="top">
              <div id="menu"></div>
              <hr>
              <div id="content"></div>
              <hr>
              <div id="dynamicSliders">placeholder</div>
              <hr>
              <b>Coordinates</b><div id="mousecoordinates"></div>
        </td>
        <td valign="top">
          <div id="canvasesdiv" style="position:relative; width:1000px; height:700px"> 
            <canvas
              id="myCanvas"
              width="1000"
              height="700"
              style="z-index: 1;
                      position:absolute;
                      left:0px;
                      top:0px;"
  
            ></canvas>
            <canvas id="transparentLayer"
            style="z-index: 2;
            position:absolute;
            left:0px;
            top:0px;"
            height="700px" width="1000">          </div>
          </td>
      </tr>
    </table>

<script>
"use strict";

//global variables here
      //--- global PARAMETERS ------------------------------------------------------------------
      const myCanvas = document.getElementById("myCanvas");
      const ctx = myCanvas.getContext("2d");
      const cW = myCanvas.clientWidth;
      const cH = myCanvas.clientHeight


      //--- parameters the user can change via sliders if made visible
      // -- global variables
      var x0 = params.x0.val;
      var x1 = params.x1.val;
      var y0 = params.y0.val;
      var y1 = params.y1.val;
      const fixedOrigin = params.fixedOrigin.val;

      const xIntervals=250;

      //wip
      const iGrid=20;
      const drawGrid=true;

      var reMap = new ReMap(cW, cH, x0, x1, y0, y1, fixedOrigin); //functions to map real value to canvas coordinates

      reMap.objCanvas = ctx;

      //--- calculated params
      var dx = reMap.dx();
      var dy = reMap.dy();



//---------------------------------------
function init(){

        //--- mouse coordinates event listener --------------------------
        transparentLayer.addEventListener(
          "mousemove",
          function (evt) {
            var mousePos = getMousePos(evt);
            var tempC=new c(reMap.m2x(mousePos.x),reMap.m2y(mousePos.y));
            var message = `|z|=${m(tempC).z}<br>a=${tempC.x}<br>b=${tempC.y}`;
            writeMessage(message);

          },
          false
        );

        //--- mouse click event listener -------------------------------
        transparentLayer.addEventListener(
          "click",
          function (evt) {
            var mousePos = getMousePos(evt);

          
           //zoom WIP
            params.x0.val=reMap.m2x(mousePos.x)-(x1-x0)/4; 
            params.x1.val=reMap.m2x(mousePos.x)+(x1-x0)/4;
            params.y0.val=reMap.m2y(mousePos.y)-(y1-y0)/4;
            params.y1.val=reMap.m2y(mousePos.y)+(y1-y0)/4;
        
            loadvaluesandgo();

          },
          false
        );

  

  genNavigation("twoD");
  generateControls();
  fileToParameters(); //initiate event listener for file uploader
  reMap.drawAxis();
  plotAll();

}
//---------------------------------------
function loadvaluesandgo() {
        x0 = params.x0.val;
        x1 = params.x1.val;
        y0 = params.y0.val;
        y1 = params.y1.val;
        reMap.x0 = x0;
        reMap.x1 = x1;
        reMap.y0 = y0;
        reMap.y1 = y1;
        reMap.clearcanvas();
        plotAll();
        reMap.drawAxis();
      }
//---------------------------------------

function plotAll(){

  for (const key in params.functions) {
      const element = params.functions[key];
      if (element != false){
      function f(x) {  
         return eval(element);  
      };  
      plotFunction(f,"#121212");
    }
  }


  //plotFunction(g,"#AA0000");
  //plotFunction(h,"#00BB00");

}

//________________________________________________________

/*
function evil(fn) {
  return new Function('return ' + fn)();
}
*/

function f(exp) {  
  return eval(exp);  
};

function g(x) {
  return Math.sin(2*x);  
};
function h(x) {
  return Math.sin(3*x);   
};
//_______________________________________________________


//-------------------------------------------
function plotFunction(objF,strColor) {

  ctx.beginPath();
  ctx.strokeStyle = strColor; //"#FF0000";
  ctx.lineWidth=0.5;
//  ctx.strokeStyle = "#0000D3";

  var xi=x0;
  var yi=objF(x0);
  var yii=0;
  var yc=0;
  
  ctx.moveTo(0,reMap.y(yi)); //first point on the map
/*  
  do {
    
    //calculate next point
    var xi=xi+dx;
    var yi=objF(xi);
    ctx.lineTo(reMap.x(xi),reMap.y(yi));
    //xi=xii;
    //yi=yii;
    ctx.moveTo(reMap.x(xi),reMap.y(yi)); //move to next point
  } while (xi < x1);

  ctx.stroke();  
  */ 

//max resolution, 1px at the time
  for (let xc = 0; xc < cW+1; xc++) {
    xc=xc+1; //next canvas point
    yii=objF(reMap.m2x(xc));
    yc=reMap.y(yii);
    ctx.lineTo(xc,yc);
    ctx.moveTo(xc,yc); //move to next point  
  }
    ctx.stroke();
 
}
//-------------------------------------------


</script> 

</body>
</html>
