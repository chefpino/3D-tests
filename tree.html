<!DOCTYPE html>
<html>

<body>

<canvas id="myCanvas" width="1400" height="700" style="border:1px solid">
Your browser does not support the HTML5 canvas tag.</canvas>

<script>
const cW=1400;
const cH=700;
const c = document.getElementById("myCanvas");
const ctx = c.getContext("2d"); 
const initAngle=Math.PI/2; //trunk angle
const dAngle=Math.PI/7;    //bifurcation angle
const initLen=150;         //max 150
const minLen=30;           //20, 25 nice
const reduction=0.8;       //0.8 nice
const pi=Math.PI;
const initTrunk=20;
const trunkReduction=0.5;

function px(x){
  return cW/2+x;
}
function py(y){
  return cH-y;
}
function plot(x,y) {
  ctx.beginPath();
  ctx.fillStyle = "#FF0000";
  ctx.fillRect(x,y,3,3);
}
//---------- DRAW --------------------------------------------
function draw(x,y,angle,len,trunk){
  
    var newx=x+len*Math.cos(angle);
    var newy=y+len*Math.sin(angle);
    
    ctx.lineWidth = .5+trunk;


    ctx.beginPath();
    ctx.save();

    ctx.moveTo(px(x),py(y));
    ctx.lineTo(px(newx),py(newy));
    ctx.stroke();
    if (len >= minLen) {      
      draw(newx,newy,angle+pi/2*Math.random()*dAngle,len*reduction,trunk*trunkReduction);
      draw(newx,newy,angle-pi/2*Math.random()*dAngle,len*reduction,trunk*trunkReduction);
      draw(newx,newy,angle,len*reduction,trunk*trunkReduction);

    } else {
      leaf(newx,newy,.5*len,angle,2*pi/3);
    }
     
  }   
//-------------------- INIT---------------------------
  function init(){
    ctx.beginPath();
    ctx.strokeStyle = "darkgreen";
    
    
    
    //leaf(100,100,200,pi/6,0.35*pi);
    //leaf(100,100,200,pi,0.35*pi);
    
    //ctx.moveTo(px(0),py(0));
    
    //draw(250,0,pi/2,90);
    //draw(-250,0,pi/2,95);
    
    draw(0,0,initAngle,initLen,initTrunk);
  }  
//----------------------------------------------------

function leaf(x,y,l,alpha,beta){
  /*
  x,y coordinate beginning leaf
  l: length of leaf
  alpha: angle of the leaf simmetry line
  b: angle of the arc describing the leaf 
  */
  
  var r=l/(2*Math.sin(beta/2));
  var gamma=pi/2-beta/2-alpha;
  var xc=0;
  var yc=0;


 // leaf first half ----------------------------
  
  
  //calc center
  xc=x+r*Math.cos(gamma);
  yc=y-r*Math.sin(gamma);
  
  ctx.beginPath();
  ctx.strokeStyle = "darkgreen";
  ctx.moveTo(px(x),py(y));
  ctx.lineTo(px(x+l*Math.cos(alpha)),py(y+l*Math.sin(alpha)));
  ctx.stroke(); 

  ctx.arc(px(xc),py(yc), r, 2*pi-(pi-gamma-beta),2*pi-(pi-gamma),true);
  ctx.fillStyle = "yellow";
  ctx.fill();
  ctx.stroke();
  
  //plot(px(xc),py(yc));

   // leaf second  half ----------------------------
  //calc center

  var diagonal=Math.sqrt(r*r-l*l/4)
  xc=xc-2*diagonal*Math.cos(gamma+beta/2);
  yc=2*diagonal*Math.sin(gamma+beta/2)+yc;

  //plot(px(xc),py(yc));
  //console.log(xc,yc);

  ctx.beginPath();
  //ctx.strokeStyle = "darkgreen";
  //ctx.moveTo(px(x),py(y));
  //ctx.lineTo(px(x+l*Math.cos(alpha)),py(y+l*Math.sin(alpha)));
  //ctx.stroke(); 

  //ctx.arc(px(xc),py(yc), r, 0,2*pi,true);
  ctx.arc(px(xc),py(yc), r, -1*(alpha+beta/2)+pi/2,-1*(alpha-beta/2)+pi/2,false);
  ctx.fillStyle = "darkred";
  ctx.fill();
  ctx.stroke();






  
}


 
//-------------------------------------------
function drawAxis() {  
  ctx.strokeStyle = "#000000"; 
  ctx.moveTo(xMap(x0),yMap(0));
  ctx.lineTo(xMap(x1),yMap(0));
  ctx.stroke();
  ctx.moveTo(xMap(0),yMap(y0));
  ctx.lineTo(xMap(0),yMap(y1));
  ctx.stroke();  
};
//-------------------------------------------

init();


</script> 





</body>
</html>
