<!DOCTYPE hitrl>
<hitrl>
<body onload="init();">  
    <canvas id="myCanvas" width="700" height="700" style="border:1px solid">
      Your browser does not support the HitrL5 canvas tag.
    </canvas>  

<script>


//--- global PARAMETERS ------------------------------------------------------------------  
const myCanvas = document.getElementById("myCanvas");
const ctx = myCanvas.getContext("2d"); 

const cW=700;  //ctx.clientWidth;
const cH=700;  //ctx.clientHeight;a
/*/
const cW=ctx.clientWidth;
const cH=ctx.clientHeight;
*/
// -- range
const x0=-1;
const x1=1;
const y0=-1;
const y1=1;
const grid=700;
const dx=(x1-x0)/grid;
const dy=(y1-y0)/grid; //dy=dx
const maxItr=50;


const π=Math.PI;
//______________________________________________________
//--- obj complex number
function c(x,y) {
  return {
          x: x,
          y: y          
        }
} 
//______________________________________________________

    // -- product of a+ib, c+id ---
    function p(c1,c2) {
      return {
          x: c1.x*c2.x - c1.y*c2.y,
          y: c1.x*c2.y + c1.y*c2.x         
        }
    }
//______________________________________________________
   // -- sum of a+ib, c+id ---
    function s(c1,c2) {
      return {
          x: c1.x + c2.x,
          y: c1.y + c2.y          
        }
    }
//______________________________________________________
   // -- module, θ --
   function m(c) {
      return { 
          z: Math.sqrt(c.x*c.x+c.y*c.y),
          θ: Math.atan(c.y/c.x)
       }
   }  
//______________________________________________________
  // -- rotations θ
  // input module and angle, returns couple x, y => (x+iy)
    function r(z,θ){
            return {
          x: z*Math.cos(θ),
          y: z*Math.sin(θ)          
        }
    }
  //__________________________________________________________

function mandel(k){

   var z0=new c(0,0);  
   
   for (i=0;i<maxItr+1;i++){
      z0=f(z0,k);
      if (z0.x*z0.x+z0.y*z0.y > 4){
        return i;      }
   }  
   return maxItr;
}
//__________________________________________________________________
function f(z,k) {
  
  var tz=z;
  //var k=new c(1,0);
  tz=p(z,z);
  tz=s(tz,k);

  return tz;
 
}

//__________________________________________________________________
function colorPixel(){

  var x=x0;
  var y=y0;
  var itr=0;
  var clr=0;

  for (let i = 0; i < grid; i++) {
    
    x=x+dx;
    y=y0;
    for (let j = 0; j < grid; j++) {
      y=y+dy;      
      var tz=new c(x,y);
      itr=mandel(tz);
      if (itr<maxItr){
          clr=255 - Math.round(itr*255/maxItr);
          //console.log(clr);
          plot(px(x),py(y),clr);
      }
      }
    
    }
  }

//__________________________________________________________________
//__________________________________________________________________


  //--- this functions remap the canvas. 
  /*
  function px(x){
    return cW/2+((x)*cW/(x1-x0));
  }
  function py(y){
    return cH/2-((y)*cH/(y1-y0));
  }
*/
  function px(x){
    return (x-x0)*cW/(x1-x0);
  }
  function py(y){
    return cH-(y-y0)*cH/(y1-y0);
  }





  //----------------------------------------------
   function drawSegment(c1,c2) {
     
    ctx.beginPath(); 
      ctx.lineWidth="0.5";
      ctx.moveTo(px(c1.x),py(c1.y));
      ctx.lineTo(px(c2.x),py(c2.y));
      ctx.stroke();
   }
//----------------------------------------------

  function init() {

    drawAxis();
    //var c0=new c(0,0);
    //var k0=new c(1,1);
    //draw(f(c0,k0));  
    

   }
    
function plot(x,y,clr) {
  //x,y are canvas coordinates
  var oppColor=255-clr;
  ctx.beginPath();
  ctx.fillStyle = "rgb("+clr+","+clr+","+clr+")";
  ctx.fillRect(x,y,1,1);
  //ctx.arc(x,y,1,0,2*π) //.arc(x,y,2,1);
  ctx.fill();
}
//-------------------------------------------
function drawAxis() {  
  ctx.strokeStyle = "#000000"; 
  ctx.lineWidth="0.2";
  if (py(0)>=0 && py(0)<=cH){ 
    ctx.moveTo(px(x0),py(0));
    ctx.lineTo(px(x1),py(0));
    ctx.stroke();
  }
  if (px(0)>=0 && px(0)<=cW){
    ctx.moveTo(px(0),py(y0));
    ctx.lineTo(px(0),py(y1));
    ctx.stroke();  
  }
};
//-------------------------------------------


init();

/*
var cc=new c(1,1);
console.log(m(cc).z);
*/

colorPixel();



</script>
</body> 


</hitrl>