<!DOCTYPE html>
<html>
  <head>
    <script src="../../navigation/menu.js"></script>
    <link rel="stylesheet" type="text/css" href="../../css/main.css" />
    <script src="../../math-library/math-complexnumbers.js"></script>
    <script src="../../math-library/graphicfunctions.js"></script>
    <script src="../../navigation/controls.js"></script>
    

    <script src="2d-library.js"></script>
    <script src="../../pages-data/twod.data.js"></script>
  </head>
  <body onload="init();">
    <table border="0">
      <tr>
        <td valign="top">
              <div id="menu"></div>
              <img height=1 width=400 src="../../imgs/1pxBlack.gif">
              <div id="content"></div>
        </td>
        <td valign="top" rowspan="2">
          <div id="canvasesdiv" style="position:relative; width:1000px; height:500px"> 
            <canvas
              id="myCanvas"
              width="1000"
              height="500"
              style="z-index: 1;
                      position:absolute;
                      left:0px;
                      top:0px;
                      border:0px solid;"
            ></canvas>
            <canvas id="transparentLayer"
            style="z-index: 2;
            position:absolute;
            left:0px;
            top:0px;
            border:0px solid;"
            height="500px" width="1000">          </div>
          </td>
      </tr>
      <tr>  
        <td valign="top" width="100">
          <div id="content"></div>
          <img height=1 width=400 src="../../imgs/1pxBlack.gif">
          <div id="listFunctions">placeholder</div>
          <img height=1 width=400 src="../../imgs/1pxBlack.gif">
          <div id="dynamicSliders"></div>
          <img height=1 width=400 src="../../imgs/1pxBlack.gif">
          <b>Coordinates</b><div id="mousecoordinates"></div>
        </td>
      </tr>
    </table>
<script>
"use strict";

//global variables here
      //--- global PARAMETERS ------------------------------------------------------------------
      const myCanvas = document.getElementById("myCanvas");
      const ctx = myCanvas.getContext("2d");
      var   cW = myCanvas.clientWidth;
      var   cH = myCanvas.clientHeight
      const fixedOrigin = params.fixedOrigin.val;

      //--- parameters the user can change via sliders if made visible
      // -- global variables
      var x0, x1, y0, y1;
      var zoomIn;
      loadValues();
      var lockRatio=params.lockratio.val;


      //wip
      const drawGrid=true;

      var reMap = new ReMap(cW, cH, x0, x1, y0, y1, fixedOrigin); //functions to map real value to canvas coordinates
      reMap.objCanvas = ctx;

      //--- calculated params
      var dx = reMap.dx();
      var dy = reMap.dy();



//---------------------------------------
function init(){

        //--- mouse coordinates event listener --------------------------
        transparentLayer.addEventListener(
          "mousemove",
          function (evt) {
            var mousePos = getMousePos(evt);
            var tempC=new c(reMap.m2x(mousePos.x),reMap.m2y(mousePos.y));
            var message = `x=${tempC.x}<br>y=${tempC.y}`;
            writeMessage(message);
          },
          false
        );

        //--- mouse click event listener -------------------------------
        transparentLayer.addEventListener(
          "click",
          function (evt) {
            var mousePos = getMousePos(evt);

            zoomIn=params.zoomIn.val;

            //zoom in
            if (zoomIn==1){
            params.x0.val=reMap.m2x(mousePos.x)-(x1-x0)/4; 
            params.x1.val=reMap.m2x(mousePos.x)+(x1-x0)/4;
            params.y0.val=reMap.m2y(mousePos.y)-(y1-y0)/4;
            params.y1.val=reMap.m2y(mousePos.y)+(y1-y0)/4;
            }
            else {
            params.x0.val=reMap.m2x(mousePos.x)-(x1-x0); 
            params.x1.val=reMap.m2x(mousePos.x)+(x1-x0);
            params.y0.val=reMap.m2y(mousePos.y)-(y1-y0);
            params.y1.val=reMap.m2y(mousePos.y)+(y1-y0);
            }

            loadvaluesandgo();

          },
          false
        );

  

  genNavigation("twoD",true);
  generateControls();
  displayFunctions();
  //fileToParameters(); //initiate event listener for file uploader
  reMap.lineWidth=0.1;
  reMap.strokeStyle="#BBBBBB";
  reMap.drawAxis();
  if (params.grid.val==true){ reMap.drawGrid()};
  plotAll();

}
//---------------------------------------
function loadValues(){
        x0 = params.x0.val;
        x1 = params.x1.val;
        y0 = params.y0.val;
        y1 = params.y1.val;
        zoomIn=params.zoomIn.val;

}
//---------------------------------------
function loadvaluesandgo() {

        checkLockRatio();
        loadValues();
         
        //assign values to reMap object
        reMap.x0 = x0;
        reMap.x1 = x1;
        reMap.y0 = y0;
        reMap.y1 = y1;

        reMap.clearcanvas();
        plotAll();
        reMap.drawAxis();
        if (params.grid.val==true){ 
            reMap.lineWidth=0.1;
            reMap.drawGrid();
          };

      }
//---------------------------------------

function checkLockRatio(){

             if (params.lockratio.val==1){
              
              cH=cW*(y1-y0)/(x1-x0); //new canvas height
              //resize canvases (visible and invisible)
              reMap.cH=cH;
              myCanvas.height = cH;
              document.getElementById("transparentLayer").height = cH;

              //make y sliders invisible:
              document.getElementById("y0").style.display="none";
              document.getElementById("y1").style.display="none";
             }

             if (params.lockratio.val==0){
              
              cH=700;; //new canvas height - HARDCODED
              //resize canvases
              reMap.cH=cH;
              myCanvas.height = cH;
              document.getElementById("transparentLayer").height = cH;

              //make y sliders visible:
              document.getElementById("y0").style.display="block";
              document.getElementById("y1").style.display="block";
              
             }



}

//-------------------------------------------
function plotAll(){

  for (const key in params.functions) {
      const element = params.functions[key];
      if (element != false){
      function f(x) {  
         return eval(element);  
      };  
      plotFunction(f,"#0000FF");
    }
  }
}
//-------------------------------------------
function plotFunction(objF,strColor) {

  ctx.beginPath();
  ctx.strokeStyle = strColor; //"#FF0000";
  ctx.lineWidth=0.3;
//  ctx.strokeStyle = "#0000D3";

  var xi=x0;
  var yi=objF(x0);
  var yii=0;
  var yc=0;
  
  ctx.moveTo(0,reMap.y(yi)); //first point on the map


//max resolution, 1px at the time
  for (let xc = 0; xc < cW+1; xc++) {
    xc=xc+1; //next canvas point
    yii=objF(reMap.m2x(xc));
    yc=reMap.y(yii);
    ctx.lineTo(xc,yc);
    ctx.moveTo(xc,yc); //move to next point  
  }
    ctx.stroke();
 
}
//-------------------------------------------

function displayFunctions(){

document.getElementById("listFunctions").innerHTML=listFunctions();

}



</script> 

</body>
</html>
